#!/usr/bin/env ruby

older_than = Time.now

stale_branches = `/usr/local/bin/git for-each-ref --sort=committerdate refs/heads refs/remotes --format='%(refname:short)'`

stale_branches.split("\n").each do |b|
  puts `git log -1 --pretty=format:'%C(cyan)%cr%C(reset) %C(yellow)%h%C(reset) %s %C(blue)%an%C(reset) %C(green)%d%C(reset)' #{b}`
  puts b

  puts "Delete?"
  if gets =~ /^y/i
    puts "Deleting"
    b =~ %r{\A(.*)/(.*)\z}
    if $1
      cmd = "git push #{$1} :#{$2}"
      puts cmd
      `#{cmd}`
    else
      cmd = "git branch -D #{b}"
      puts cmd
      `#{cmd}`
    end
  end
  puts
end
